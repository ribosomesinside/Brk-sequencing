keytype = "FLYBASE",
multiVals = "first"
)
plotCounts(dds, gene="FBgn0003525", intgroup="Group") #string
View(ubiLFC_s)
ubiLFC_s %>%
filter(baseMean>100, abs(log2FoldChange)>1 & abs(log2FoldChange)<2)
View(ubiLFC_s)
ubiLFC %>%
as.data.frame() %>%
arrange(log2FoldChange) -> ubiLFC_all
```{r}
ubiLFC_all$gene = mapIds(
org.Dm.eg.db,
keys = rownames(ubiLFC_all),
column ="SYMBOL",
keytype = "FLYBASE",
multiVals = "first"
)
ubiLFC_all$gene = mapIds(
org.Dm.eg.db,
keys = rownames(ubiLFC_all),
column ="SYMBOL",
keytype = "FLYBASE",
multiVals = "first"
)
View(ubiLFC_all)
plotCounts(dds, gene="FBgn0003525", intgroup="Group") #Sal
plotCounts(dds, gene="FBgn0261648", intgroup="Group") #Sal
plotCounts(dds, gene="FBgn0036690", intgroup="Group") #ppan
plotCounts(dds, gene="FBgn0053542", intgroup="Group") #ppan
plotCounts(dds, gene="FBgn0004956", intgroup="Group") #ppan
plotCounts(dds, gene="FBgn0036690", intgroup="Group") #ppan
plotCounts(dds, gene="FBgn0261648", intgroup="Group") #Sal
plotCounts(dds, gene="FBgn0011706", intgroup="Group") #reaper
plotCounts(dds, gene="FBgn0004394", intgroup="Group") #ppan
plotCounts(dds, gene="FBgn0086758", intgroup="Group") #chinmo
plotCounts(dds, gene="FBgn0004394", intgroup="Group") #pdm2
plotCounts(dds, gene="FBgn0086758", intgroup="Group") #chinmo
salLFC %>%
as.data.frame() %>%
arrange(log2FoldChange) -> salLFC_all
salLFC_all$gene = mapIds(
org.Dm.eg.db,
keys = rownames(salLFC_all),
column ="SYMBOL",
keytype = "FLYBASE",
multiVals = "first"
)
salLFC_all$gene = mapIds(
org.Dm.eg.db,
keys = rownames(salLFC_all),
column ="SYMBOL",
keytype = "FLYBASE",
multiVals = "first"
)
View(salLFC_all)
plotCounts(dds, gene="FBgn0004394", intgroup="Group") #pdm2
plotCounts(dds, gene="FBgn0262656", intgroup="Group") #myc
plotCounts(dds, gene="FBgn0025360", intgroup="Group") #optix
plotCounts(dds, gene="FBgn0261649", intgroup="Group") #chinmo
plotCounts(dds, gene="FBgn0000179", intgroup="Group") #omb norm counts
plotCounts(dds, gene="FBgn0035954", intgroup="Group") #tincar
plotCounts(dds, gene="FBgn0283451", intgroup="Group") #tincar
ubiLFC_s %>%
filter(baseMean>100, log2FoldChange<-0.2)
ubiLFC_s %>%
filter(baseMean>100, log2FoldChange<(-0.2))
ubiLFC_s %>%
filter(baseMean>100, log2FoldChange<(-0.2)) -> ubi_down001
ubiLFC_s %>%
filter(baseMean>100, abs(log2FoldChange)>1 & abs(log2FoldChange)<2)
fwrite(ubi_down001, file = "./ubi_down001.csv")
fwrite(ubi_down001, file = "./ubi_down001.xlsx")
View(ubi_down001)
plotCounts(dds, gene="FBgn0261649", intgroup="Group") #tinc
View(ubi_down001)
salLFC_all %>%
filter(padj<0.1) %>%
arrange(log2FoldChange)
View(ubiLFC_all)
plotCounts(dds, gene="FBgn0261648", intgroup="Group") #Sal
plotCounts(dds, gene="FBgn0000179", intgroup="Group") #omb norm counts
plotCounts(dds, gene="FBgn0035954", intgroup="Group") #tinc
plotCounts(dds, gene="FBgn0000179", intgroup="Group") #omb norm counts
View(res)
res
res
res %>% filter(padj<0.01)
res %>%
as.data.frame() %>%
filter(padj<0.01) ->dres
View(dres)
res %>%
as.data.frame() %>%
filter(padj<0.01) ->dres
dres$gene = mapIds(
org.Dm.eg.db,
keys = rownames(ubiLFC_all),
column ="SYMBOL",
keytype = "FLYBASE",
multiVals = "first"
)
dres$gene = mapIds(
org.Dm.eg.db,
keys = rownames(dres),
column ="SYMBOL",
keytype = "FLYBASE",
multiVals = "first"
)
res %>%
as.data.frame() %>%
filter(padj<0.01) ->dres
View(dres)
View(dres)
res %>%
as.data.frame() %>%
filter(padj<0.01) ->dres
sum(res$padj < 0.05, na.rm=TRUE)
sum(res$padj < 0.01, na.rm=TRUE)
#| message: false
library(DESeq2)
library(apeglm)
library(dplyr)
library(tibble)
library(data.table)
library(ggplot2)
library(ggfortify)
library(ggrepel)
library(RColorBrewer)
library(pheatmap)
library(plotly)
library(magrittr)
library(AnnotationDbi)
library(org.Dm.eg.db)
res %>%
as.data.frame() %>%
filter(padj<0.01) ->dres
dres$gene = mapIds(
org.Dm.eg.db,
keys = rownames(dres),
column ="SYMBOL",
keytype = "FLYBASE",
multiVals = "first"
)
View(dres)
knitr::opts_chunk$set(dev = "png",
dpi = 300,
echo = FALSE,
cache = TRUE)
library(DESeq2)
library(apeglm)
library(dplyr)
library(tibble)
library(tidyverse)
library(data.table)
library(ggplot2)
library(ggfortify)
library(ggrepel)
library(RColorBrewer)
library(pheatmap)
library(plotly)
library(magrittr)
library(AnnotationDbi)
library(org.Dm.eg.db)
library(writexl)
counts <- fread(file ="rsem.merged.gene_counts.tsv", header=TRUE)
sample_info <- read.delim(file = "Data info/RN23010-sampleinfo_full.txt")
info<-sample_info %>% column_to_rownames("Sample")
info %>%  filter(Group !='sal-brk') ->ninfo
gcounts <- counts[, -c(2,6:8)]
dt <- as.data.frame(gcounts) %>%
column_to_rownames("gene_id")
dt[,1:6] <- lapply(dt[,1:6], as.integer)
mcountdata <- as.matrix(dt)
has_rownames(dt)
has_rownames(ninfo)
all(rownames(ninfo) == colnames(mcountdata))
mcountdata_s <- mcountdata[, rownames(ninfo)]
all(rownames(ninfo) == colnames(mcountdata_s))
ninfo$Group <- factor(ninfo$Group,levels = c("control", "ubi-brk"))
info$Repeat <- as.factor(info$Repeat)
dds <- DESeqDataSetFromMatrix(countData = mcountdata_s,
colData = ninfo,
design = ~Group)
dds <- DESeq(dds)
res <- results(dds)
sum(res$padj < 0.01 & res$log2FoldChange< (-0.3), na.rm=TRUE)
resultsNames(dds)
ubiLFC <- lfcShrink(dds, coef="Group_ubi.brk_vs_control", type="apeglm")
plotMA(res, ylim=c(-4,4))
plotMA(ubiLFC, ylim=c(-4,4))
ubiLFC %>%
as.data.frame() %>%
mutate(., gene = mapIds(
org.Dm.eg.db,
keys = rownames(.),
column ="SYMBOL",
keytype = "FLYBASE",
multiVals = "first"
)) %>%
rownames_to_column(.) %>%
mutate(gene = coalesce(gene,rowname)) %>%
rename(., ID=rowname) -> ubiLFC_genes
ubiLFC_genes %>%
filter((padj<0.01) & (baseMean>100)) %>%
arrange(log2FoldChange) -> ubiLFC_s
#write_xlsx(ubiLFC_s, "ubi-brk-signif.xlsx")
ubiLFC_s %>%
filter(!stringr::str_detect(ID, "FBti")) ->ubiLFC_s_pel.rm
View(ubiLFC_s_pel.rm)
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value")
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25)))
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point(colo) +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw()
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point(color=log2FoldChange) +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw()
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw()
View(ubiLFC_genes)
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw() +
geom_text_repel(data=head(., 20), aes(label=gene))
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw() +
geom_text_repel(data=head(ubiLFC_s_pel.rm, 20), aes(label=gene))
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw() +
geom_label_repel(data=head(ubiLFC_s_pel.rm, 20), aes(label=gene))
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw() +
geom_label_repel(aes(label=gene))
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw() +
geom_label_repel(aes(head(ubiLFC_s_pel.rm, 20),label=gene, max.overlaps=20))
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw() +
geom_label_repel(data=head(ubiLFC_s_pel.rm, 20), aes(label=gene), max.overlaps=20)
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw() +
geom_label_repel(data=head(ubiLFC_s_pel.rm, 30), aes(label=gene), max.overlaps=20)
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw() +
geom_label_repel(data=head(ubiLFC_s_pel.rm, 30), aes(label=gene), max.overlaps=30)
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw() +
geom_label_repel(data=head(ubiLFC_s_pel.rm, 20), aes(label=gene), max.overlaps=30)
BiocManager::install("clusterProfiler", version = "3.8")
BiocManager::install("clusterProfiler")
BiocManager::install("pathview")
BiocManager::install("enrichplot")
library(clusterProfiler)
library(enrichplot)
library(DESeq2)
library(apeglm)
library(dplyr)
library(tibble)
library(tidyverse)
library(data.table)
library(ggplot2)
library(ggfortify)
library(ggrepel)
library(RColorBrewer)
library(pheatmap)
library(plotly)
library(magrittr)
library(AnnotationDbi)
library(org.Dm.eg.db)
library(writexl)
counts <- fread(file ="rsem.merged.gene_counts.tsv", header=TRUE)
sample_info <- read.delim(file = "Data info/RN23010-sampleinfo_full.txt")
info<-sample_info %>% column_to_rownames("Sample")
info %>%  filter(Group !='sal-brk') ->ninfo
gcounts <- counts[, -c(2,6:8)]
dt <- as.data.frame(gcounts) %>%
column_to_rownames("gene_id")
dt[,1:6] <- lapply(dt[,1:6], as.integer)
mcountdata <- as.matrix(dt)
has_rownames(dt)
has_rownames(ninfo)
all(rownames(ninfo) == colnames(mcountdata))
mcountdata_s <- mcountdata[, rownames(ninfo)]
all(rownames(ninfo) == colnames(mcountdata_s))
ninfo$Group <- factor(ninfo$Group,levels = c("control", "ubi-brk"))
info$Repeat <- as.factor(info$Repeat)
dds <- DESeqDataSetFromMatrix(countData = mcountdata_s,
colData = ninfo,
design = ~Group)
dds <- DESeq(dds)
res <- results(dds)
sum(res$padj < 0.01 & res$log2FoldChange< (-0.3), na.rm=TRUE)
resultsNames(dds)
ubiLFC <- lfcShrink(dds, coef="Group_ubi.brk_vs_control", type="apeglm")
plotMA(res, ylim=c(-4,4))
plotMA(ubiLFC, ylim=c(-4,4))
ubiLFC %>%
as.data.frame() %>%
mutate(., gene = mapIds(
org.Dm.eg.db,
keys = rownames(.),
column ="SYMBOL",
keytype = "FLYBASE",
multiVals = "first"
)) %>%
rownames_to_column(.) %>%
mutate(gene = coalesce(gene,rowname)) %>%
rename(., ID=rowname) -> ubiLFC_genes
ubiLFC_genes %>%
filter((padj<0.01) & (baseMean>100)) %>%
arrange(log2FoldChange) -> ubiLFC_s
#write_xlsx(ubiLFC_s, "ubi-brk-signif.xlsx")
ubiLFC_s %>%
filter(!stringr::str_detect(ID, "FBti")) ->ubiLFC_s_pel.rm
ggplot(ubiLFC_s_pel.rm, aes(log2FoldChange, -log10(padj))) +
geom_point() +
xlab("log2 fold change") +
ylab("-log10 adjusted p-value") +
theme(legend.position = "none",
plot.title = element_text(size = rel(1.5), hjust = 0.5),
axis.title = element_text(size = rel(1.25))) +
theme_bw() +
geom_label_repel(data=head(ubiLFC_s_pel.rm, 20), aes(label=gene), max.overlaps=30)
#BiocManager::install("clusterProfiler")
#BiocManager::install("pathview")
#BiocManager::install("enrichplot")
library(clusterProfiler)
library(enrichplot)
ubiLFC_genes %>%
arrange(desc(log2FoldChange)) %>%
filter(!stringr::str_detect(ID, "FBti")) %>%
na.omit() %>%
select(gene, log2FoldChange) %>%
deframe()-> ubiLFC_fc_rank
gse_fc<- gseGO (ubiLFC_fc_rank,
ont="BP",
OrgDb=org.Dm.eg.db,
keyType="SYMBOL",
pvalueCutoff = 0.05,
verbose = TRUE,
minGSSize=3,
pAdjustMethod = "BH")
summary(gse_fc) %>% as.tibble() -> gse_fc_sum
gseaplot(gse_fc, by = "all", title = gse_fc$Description[1], geneSetID = 1)
top20<-dotplot(gse_fc, showCategory=20)
up_down<-dotplot(gse_fc, showCategory=5, split=".sign") + facet_grid(.~.sign)
cowplot::plot_grid(top20, up_down, ncol=1, labels=LETTERS[1:2])
View(gse_fc_sum)
dotplot(gse_fc, showCategory=20)
dotplot(gse_fc, showCategory=10, split=".sign") + facet_grid(.~.sign)
dotplot(gse_fc, showCategory=10, split=".sign", orderBy="Counts") + facet_grid(.~.sign)
View(gse_fc)
dotplot(gse_fc_sum, showCategory=10)
gse_fc_s<-arrange(desc(gse_fc@result@NES))
gse_fc@result@NES
gse_fc@result$NES
gse_fc_s<-arrange(desc(gse_fc@result$NES))
gse_fc_s<-sort(gse_fc@result$NES, decreasing = TRUE)
dotplot(gse_fc_s, showCategory=10)
gse_fc_s<-lapply(gse_fc@result$NES, sort, decreasing = TRUE)
dotplot(gse_fc_s, showCategory=10)
View(gse_fc_s)
top20<-dotplot(gse_fc, showCategory=10)
up_down<-dotplot(gse_fc, showCategory=10, split=".sign", orderBy="Counts") + facet_grid(.~.sign)
up_down
#cowplot::plot_grid(top20, up_down, ncol=1, labels=LETTERS[1:2])
# 1. Open jpeg file
jpeg("gsea.jpg", width = 350, height = 700)
# 2. Create the plot
up_down
# 3. Close the file
dev.off()
# 1. Open jpeg file
jpeg("gsea.jpg", width = 400, height = 700)
# 2. Create the plot
up_down
# 3. Close the file
dev.off()
# 1. Open jpeg file
jpeg("gsea.jpg", width = 500, height = 700)
# 2. Create the plot
up_down
# 3. Close the file
dev.off()
View(ubiLFC_genes)
gseaplot2(gse_fc, geneSetID = 1, title = gse_wald$Description[1])
gseaplot2(gse_fc, geneSetID = 1, title = gse_fc$Description[1])
gseaplot2(gse_fc, showCategory="respiratory electron transport chain", title = gse_fc$Description[9])
gseaplot2(gse_fc, geneSetID = 9, title = gse_fc$Description[9])
gseaplot2(gse_fc, geneSetID = "GO:0022904", title = gse_fc$Description[9])
gseaplot2(gse_fc, geneSetID = "GO:0022904", title = gse_fc$Description["GO:0022904"])
gse_fc$Description
gseaplot2(gse_fc, geneSetID = "GO:0022904", title = gse_fc$Description[13])
par(mfrow=c(3,1))
ribo<-gseaplot2(gse_fc, geneSetID = "GO:0042254", title = gse_fc$Description[1])
resp<-gseaplot2(gse_fc, geneSetID = "GO:0022904", title = gse_fc$Description[13])
repl<-gseaplot2(gse_fc, geneSetID = "GO:0006260", title = gse_fc$Description[8])
ribo<-gseaplot2(gse_fc, geneSetID = "GO:0042254", title = gse_fc$Description[1])
resp<-gseaplot2(gse_fc, geneSetID = "GO:0022904", title = gse_fc$Description[13])
repl<-gseaplot2(gse_fc, geneSetID = "GO:0006260", title = gse_fc$Description[8])
par(mfrow=c(3,1))
ribo
resp
repl
ribo<-gseaplot2(gse_fc, geneSetID = "GO:0042254", title = gse_fc$Description[1])
resp<-gseaplot2(gse_fc, geneSetID = "GO:0022904", title = gse_fc$Description[13])
repl<-gseaplot2(gse_fc, geneSetID = "GO:0006260", title = gse_fc$Description[8])
cowplot::plot_grid(ribo, resp, repl, ncol=1, labels=LETTERS[1:3])
install.packages("cowplot")
library(cowplot)
ribo<-gseaplot2(gse_fc, geneSetID = "GO:0042254", title = gse_fc$Description[1])
resp<-gseaplot2(gse_fc, geneSetID = "GO:0022904", title = gse_fc$Description[13])
repl<-gseaplot2(gse_fc, geneSetID = "GO:0006260", title = gse_fc$Description[8])
cowplot::plot_grid(ribo, resp, repl, ncol=1, labels=LETTERS[1:3])
cowplot::plot_grid(ribo, resp, ncol=1, labels=LETTERS[1:2])
ribo<-gseaplot2(gse_fc, geneSetID = "GO:0042254", title = gse_fc$Description[1])
gseaplot2(gse_fc, geneSetID = "GO:0042254", title = gse_fc$Description[1])
gseaplot2(gse_fc, geneSetID = "GO:0022904", title = gse_fc$Description[13])
gseaplot2(gse_fc, geneSetID = "GO:0006260", title = gse_fc$Description[8])
ribo<-gseaplot2(gse_fc, geneSetID = "GO:0042254", title = gse_fc$Description[1])
resp<-gseaplot2(gse_fc, geneSetID = "GO:0022904", title = gse_fc$Description[13])
repl<-gseaplot2(gse_fc, geneSetID = "GO:0006260", title = gse_fc$Description[8])
cowplot::plot_grid(ribo, resp, repl, labels=LETTERS[1:2])
ribo<-gseaplot2(gse_fc, geneSetID = "GO:0042254", title = gse_fc$Description[1])
resp<-gseaplot2(gse_fc, geneSetID = "GO:0022904", title = gse_fc$Description[13])
repl<-gseaplot2(gse_fc, geneSetID = "GO:0006260", title = gse_fc$Description[8])
ribo_plot <- as_ggplot(ribo)
ribo_plot <- cowplot::as_ggplot(ribo)
